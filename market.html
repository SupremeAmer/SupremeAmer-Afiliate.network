<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market | SupremeAmer Affiliate Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
  <style>
    body { font-family: 'Inter', Arial, sans-serif; background: #f7f6fd; min-height: 100vh; margin: 0; }
    .market-main {
      max-width: 540px;
      margin: 35px auto 0 auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 28px #7c43bd22;
      padding: 2.2em 1.5em 2.5em 1.5em;
      min-height: 450px;
      animation: fadeIn .8s;
    }
    .section-title { font-size:1.2em; font-weight:bold; color:#4b0082; }
    .market-actions { display:flex;gap:14px;margin-bottom:1.2em; }
    .market-actions input,
    .market-actions select { padding:.6em .9em; border-radius:7px; border:1.3px solid #d1d5db; }
    .market-list { margin-top: 1.6em; }
    .card {
      background: #f9f6fd;
      border-radius: 13px;
      box-shadow: 0 3px 14px #4b00821a;
      padding: 1.2em 1.1em;
      margin-bottom: 1.15em;
      display: flex;
      gap: 18px;
      align-items: flex-start;
      animation: fadeIn .5s;
    }
    .card img {
      width: 58px;height: 58px;object-fit: cover;
      border-radius: 8px;
      background: #ebebf0;
      border: 1.5px solid #e5e5ef;
    }
    .card-content { flex: 1;}
    .card-title { font-weight:bold; font-size:1.07em; color:#2a237e;}
    .card-cat { font-size:.93em; color:#7c43bd; opacity:.7;}
    .card-instr { font-size:.97em; color:#333; margin:6px 0 8px 0;}
    .card-link { color:#4b0082; font-size:.97em; text-decoration: underline;}
    .btn {border-radius:8px;font-weight:600;padding:.6em 1.3em;cursor:pointer;background:#4b0082;color:#fff;border:none;}
    .btn:active { background: #7c43bd; }
    .upload-modal-bg {
      display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;
      background:rgba(32,0,64,0.18);z-index:2000;align-items:center;justify-content:center;
    }
    .upload-modal-bg.open { display:flex; }
    .upload-modal {
      background: #fff; border-radius: 18px; padding: 32px 27px; max-width: 96vw;
      box-shadow: 0 4px 28px #7c43bd22; position:relative;
      animation: scaleIn 0.4s;
    }
    .close-modal {
      margin-top: 1.2em;
      background: #fff; color: #4b0082; border: 1.5px solid #4b0082;
    }
    .close-modal:active { background: #4b0082; color:#fff; }
    @media (max-width:600px) {
      .market-main { padding: 1.2em .6em; }
      .card { padding: .7em .5em; }
      .card img { width:40px;height:40px;}
    }
  </style>
</head>
<body>
  <div class="market-main">
    <div class="section-title">Marketplace</div>
    <div class="market-actions">
      <button id="uploadAdvertBtn" class="btn" style="background:#7c43bd;">Upload Advert</button>
      <input id="marketSearch" type="text" placeholder="Search title/category..." />
      <select id="marketSort">
        <option value="newest">Newest</option>
        <option value="crypto">Crypto</option>
        <option value="content">Video/Image</option>
        <option value="referral">Referral</option>
        <option value="social">Social</option>
      </select>
    </div>
    <div id="market-list" class="market-list"></div>
    <div style="margin-top:1.8em;text-align:center;">
      <a href="index.html" style="color:#4b0082;font-size:.98em;text-decoration:underline;">&larr; Back to Home</a>
    </div>
  </div>
  <!-- Upload Modal -->
  <div id="uploadAdvertModal" class="upload-modal-bg">
    <div class="upload-modal max-w-lg">
      <h3 class="font-bold mb-2" style="color:#4b0082;">Upload Advert/Task</h3>
      <form id="uploadAdvertForm" class="flex flex-col gap-3">
        <input type="text" id="ad-title" class="input" placeholder="Title (max 60 chars)" required maxlength="60" />
        <select id="ad-cat" class="input" required>
          <option value="">Category</option>
          <option value="crypto">Crypto</option>
          <option value="content">Video/Image</option>
          <option value="referral">Referral</option>
          <option value="social">Social</option>
        </select>
        <input type="number" id="ad-reach" class="input" min="1000" placeholder="Reach (min 1000)" required />
        <input type="url" id="ad-url" class="input" placeholder="Advert/Task URL" required />
        <textarea id="ad-desc" class="input" placeholder="Instructions (how to participate)" required></textarea>
        <input type="file" id="ad-file" accept=".png,.jpg,.jpeg,.pdf" class="input" required />
        <button type="submit" class="btn" style="background:#4b0082;">Submit Advert (0.001 BNB Fee)</button>
      </form>
      <button class="close-modal btn">Cancel</button>
    </div>
  </div>
  <script>
    // DEMO LOGIC: Replace with Appwrite DB + wallet logic for production!
    let marketAdverts = [
      { title: "Earn $SA by watching our YouTube!", category: "content", goal: 4000, url: "https://youtube.com", instructions: "Subscribe and comment on our latest video.", imageUrl: "logo.png" },
      { title: "Join SupremeAmer Telegram", category: "social", goal: 1200, url: "https://t.me/supremeamer", instructions: "Join and post your username.", imageUrl: "logo.png" }
    ];
    function renderMarket() {
      const sort = document.getElementById("marketSort").value;
      const search = document.getElementById("marketSearch").value.toLowerCase().trim();
      let ads = marketAdverts;
      if (sort && sort !== "newest") ads = ads.filter(ad => ad.category === sort);
      if (search) ads = ads.filter(ad => ad.title.toLowerCase().includes(search) || ad.category.toLowerCase().includes(search));
      let html = ads.map(ad => `
        <div class="card">
          <img src="${ad.imageUrl||'logo.png'}" alt="Ad Image" />
          <div class="card-content">
            <div class="card-title">${ad.title}</div>
            <div class="card-cat">${ad.category} &bull; Goal: ${ad.goal}</div>
            <div class="card-instr">${ad.instructions||""}</div>
            <a href="${ad.url}" class="card-link" target="_blank">Visit</a>
          </div>
        </div>
      `).join('');
      document.getElementById("market-list").innerHTML = html || "<div>No adverts found.</div>";
    }
    document.getElementById("marketSearch").oninput = renderMarket;
    document.getElementById("marketSort").onchange = renderMarket;
    renderMarket();

    // Upload Modal Logic
    function openUploadModal() { document.getElementById("uploadAdvertModal").classList.add("open"); }
    function closeUploadModal() { document.getElementById("uploadAdvertModal").classList.remove("open"); }
    document.getElementById("uploadAdvertBtn").onclick = openUploadModal;
    document.querySelector("#uploadAdvertModal .close-modal").onclick = closeUploadModal;
    document.getElementById("uploadAdvertForm").onsubmit = function(e) {
      e.preventDefault();
      const title = document.getElementById('ad-title').value.trim();
      const cat = document.getElementById('ad-cat').value;
      const reach = parseInt(document.getElementById('ad-reach').value, 10);
      const url = document.getElementById('ad-url').value.trim();
      const desc = document.getElementById('ad-desc').value.trim();
      const fileInput = document.getElementById('ad-file');
      // Simple file preview (PNG/JPG/PDF)
      if (!fileInput.files[0]) { alert("Please select a file."); return; }
      let reader = new FileReader();
      reader.onload = function(ev) {
        // Add new advert to demo array
        marketAdverts.unshift({
          title, category: cat, goal: reach, url, instructions: desc,
          imageUrl: fileInput.files[0].type.startsWith('image/') ? ev.target.result : "logo.png"
        });
        renderMarket();
        closeUploadModal();
        alert("Advert uploaded! (In production, will save to DB)");
      };
      if(fileInput.files[0].type.startsWith('image/')) reader.readAsDataURL(fileInput.files[0]);
      else { // PDF
        marketAdverts.unshift({
          title, category: cat, goal: reach, url, instructions: desc,
          imageUrl: "logo.png"
        });
        renderMarket();
        closeUploadModal();
        alert("PDF accepted. (In production, will save file to storage)");
      }
    };
  </script>
</body>
</html>